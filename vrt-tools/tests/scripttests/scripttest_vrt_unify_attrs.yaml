
# scripttestlib tests for vrt-unify-attrs


# Default input and output

- defaults:
    output:
      # No errors
      returncode: 0
      stderr: ''


- name: 'vrt-unify-attrs: No changes'
  input:
    cmdline: vrt-unify-attrs in.vrt
    file:in.vrt: &input-1 |
      <!-- #vrt positional-attributes: word -->
      <text a="b" b="a" c="d">
      <sentence a="0" b="1">
      a
      </sentence>
      </text>
      <text a="y" b="z" c="x">
      <sentence a="1" b="2">
      b
      </sentence>
      <sentence a="3" b="4">
      c
      </sentence>
      </text>
  output:
    stdout: *input-1
  transform: &transform-stdin
  - &transf-base
    name: file input
  - &transf-stdin
    name: stdin input
    input:
      cmdline:
        replace: '/in.vrt/< in.vrt/'
      shell: true


- name: 'vrt-unify-attrs: Sort attributes'
  input:
    cmdline: vrt-unify-attrs in.vrt
    file:in.vrt: &input-2 |
      <!-- #vrt positional-attributes: word -->
      <text a="b" c="d" b="a">
      <sentence b="1" a="0">
      a
      </sentence>
      </text>
      <text b="z" c="x" a="y">
      <sentence b="2" a="1">
      b
      </sentence>
      <sentence b="4" a="3">
      c
      </sentence>
      </text>
  output:
    stdout: *input-1
  transform: *transform-stdin


- name: 'vrt-unify-attrs: Add missing attributes (default value)'
  input:
    cmdline: vrt-unify-attrs in.vrt
    file:in.vrt: &input-3 |
      <!-- #vrt positional-attributes: word -->
      <text a="b" c="d">
      <sentence>
      a
      </sentence>
      </text>
      <text b="z" a="y">
      <sentence b="1">
      b
      </sentence>
      <sentence a="4">
      c
      </sentence>
      </text>
  output:
    stdout: &output-3 |
      <!-- #vrt positional-attributes: word -->
      <text a="b" b="" c="d">
      <sentence a="" b="">
      a
      </sentence>
      </text>
      <text a="y" b="z" c="">
      <sentence a="" b="1">
      b
      </sentence>
      <sentence a="4" b="">
      c
      </sentence>
      </text>
  transform: *transform-stdin


- name: 'vrt-unify-attrs: Add missing attributes (non-default value)'
  input:
    cmdline: vrt-unify-attrs --default="_" in.vrt
    file:in.vrt: *input-3
  output:
    stdout:
      value: *output-3
      transform:
        replace: '/""/"_"/'
  transform: *transform-stdin


- name: 'vrt-unify-attrs: --input-order'
  input:
    cmdline: vrt-unify-attrs --input-order in.vrt
    file:in.vrt: *input-3
  output:
    stdout: |
      <!-- #vrt positional-attributes: word -->
      <text a="b" c="d" b="">
      <sentence b="" a="">
      a
      </sentence>
      </text>
      <text a="y" c="" b="z">
      <sentence b="1" a="">
      b
      </sentence>
      <sentence b="" a="4">
      c
      </sentence>
      </text>
  transform: *transform-stdin


- name: 'vrt-unify-attrs: --first'
  input:
    cmdline: vrt-unify-attrs --first="b,c" in.vrt
    file:in.vrt: &input-4 |
      <!-- #vrt positional-attributes: word -->
      <text g="w" a="b" c="d" e="x">
      <sentence>
      a
      </sentence>
      </text>
      <text b="z" f="v" a="y" d="a">
      <sentence c="2" e="4" b="1">
      b
      </sentence>
      <sentence d="3" a="0">
      c
      </sentence>
      </text>
  output:
    stdout: |
      <!-- #vrt positional-attributes: word -->
      <text b="" c="d" a="b" d="" e="x" f="" g="w">
      <sentence b="" c="" a="" d="" e="">
      a
      </sentence>
      </text>
      <text b="z" c="" a="y" d="a" e="" f="v" g="">
      <sentence b="1" c="2" a="" d="" e="4">
      b
      </sentence>
      <sentence b="" c="" a="0" d="3" e="">
      c
      </sentence>
      </text>
  transform: &transform-stdin-comma
  - *transf-base
  - *transf-stdin
  - &transf-comma-space
    name: attrlist with spaces
    input:
      cmdline:
        replace: '/,/ /'

- name: 'vrt-unify-attrs: --last'
  input:
    cmdline: vrt-unify-attrs --last="b,c" in.vrt
    file:in.vrt: *input-4
  output:
    stdout: |
      <!-- #vrt positional-attributes: word -->
      <text a="b" d="" e="x" f="" g="w" b="" c="d">
      <sentence a="" d="" e="" b="" c="">
      a
      </sentence>
      </text>
      <text a="y" d="a" e="" f="v" g="" b="z" c="">
      <sentence a="" d="" e="4" b="1" c="2">
      b
      </sentence>
      <sentence a="0" d="3" e="" b="" c="">
      c
      </sentence>
      </text>
  transform: *transform-stdin-comma

- name: 'vrt-unify-attrs: --first and --last'
  input:
    cmdline: vrt-unify-attrs --first="b,c" --last="d,a" in.vrt
    file:in.vrt: *input-4
  output:
    stdout: |
      <!-- #vrt positional-attributes: word -->
      <text b="" c="d" e="x" f="" g="w" d="" a="b">
      <sentence b="" c="" e="" d="" a="">
      a
      </sentence>
      </text>
      <text b="z" c="" e="" f="v" g="" d="a" a="y">
      <sentence b="1" c="2" e="4" d="" a="">
      b
      </sentence>
      <sentence b="" c="" e="" d="3" a="0">
      c
      </sentence>
      </text>
  transform: *transform-stdin-comma

- name: 'vrt-unify-attrs: --first, --last, --input-order'
  input:
    cmdline: vrt-unify-attrs --first="b,c" --last=d --input-order in.vrt
    file:in.vrt: *input-4
  output:
    stdout: |
      <!-- #vrt positional-attributes: word -->
      <text b="" c="d" g="w" a="b" e="x" f="" d="">
      <sentence b="" c="" e="" a="" d="">
      a
      </sentence>
      </text>
      <text b="z" c="" g="" a="y" e="" f="v" d="a">
      <sentence b="1" c="2" e="4" a="" d="">
      b
      </sentence>
      <sentence b="" c="" e="" a="0" d="3">
      c
      </sentence>
      </text>
  transform: *transform-stdin-comma

- name: 'vrt-unify-attrs: --first with duplicate attribute'
  input:
    cmdline: vrt-unify-attrs --first="b,c,b" in.vrt
    file:in.vrt: *input-4
  output:
    stdout: ''
    returncode: 2
    stderr:
      # Use "contains", as a usage message is also output to stderr
      contains: |
        vrt-unify-attrs: error: argument --first: duplicate attribute names: b
  transform: *transform-stdin-comma

- name: 'vrt-unify-attrs: --last with duplicate attributes'
  input:
    cmdline: vrt-unify-attrs --last="c,b,c,b" in.vrt
    file:in.vrt: *input-4
  output:
    stdout: ''
    returncode: 2
    stderr:
      # Use "contains", as a usage message is also output to stderr
      contains: |
        vrt-unify-attrs: error: argument --last: duplicate attribute names: c, b
  transform: *transform-stdin-comma

- name: 'vrt-unify-attrs: Structure-specific --first with duplicate attribute'
  input:
    cmdline: vrt-unify-attrs --structure text --first="b,c,b" in.vrt
    file:in.vrt: *input-4
  output:
    stdout: ''
    returncode: 2
    stderr:
      # Use "contains", as a usage message is also output to stderr
      contains: |
        vrt-unify-attrs: error: argument --first: duplicate attribute names: b
  transform: *transform-stdin-comma

- name: 'vrt-unify-attrs: Same attributes in --first and --last'
  input:
    cmdline: vrt-unify-attrs --first="b,c" --last="d,b,a,c" in.vrt
    file:in.vrt: *input-4
  output:
    stdout: ''
    returncode: 2
    stderr: |
      vrt-unify-attrs: error: same attributes in both --first and --last: b, c
  transform: *transform-stdin-comma

- name: 'vrt-unify-attrs: Same attributes in --first and --last (structure-specific)'
  input:
    cmdline: vrt-unify-attrs --structure=text --first="c,b" --last="d,b,a,c" in.vrt
    file:in.vrt: *input-4
  output:
    stdout: ''
    returncode: 2
    stderr: |
      vrt-unify-attrs: error: same attributes in both --first and --last (structure text): c, b
  transform: *transform-stdin-comma

- name: 'vrt-unify-attrs: Same attributes in --first and --last (partly structure-specific)'
  input:
    cmdline: vrt-unify-attrs --first="b,c" --last="a" --structure=text --last="d,b,a,c" in.vrt
    file:in.vrt: *input-4
  output:
    stdout: ''
    returncode: 2
    stderr: |
      vrt-unify-attrs: error: same attributes in both --first and --last (structure text): b, c
  transform: *transform-stdin-comma


- name: 'vrt-unify-attrs: Structure-specific options'
  input:
    cmdline: vrt-unify-attrs --structure=text --first="b,c" --last=d --default="T" --structure=sentence --input-order --default="S" in.vrt
    file:in.vrt: *input-4
  output:
    stdout: |
      <!-- #vrt positional-attributes: word -->
      <text b="T" c="d" a="b" e="x" f="T" g="w" d="T">
      <sentence c="S" e="S" b="S" d="S" a="S">
      a
      </sentence>
      </text>
      <text b="z" c="T" a="y" e="T" f="v" g="T" d="a">
      <sentence c="2" e="4" b="1" d="S" a="S">
      b
      </sentence>
      <sentence c="S" e="S" b="S" d="3" a="0">
      c
      </sentence>
      </text>
  transform: *transform-stdin-comma

- name: 'vrt-unify-attrs: Structure-specific options only for some structures'
  input:
    cmdline: vrt-unify-attrs --structure=text --first="b,c" --last=d --default="T" in.vrt
    file:in.vrt: *input-4
  output:
    stdout: |
      <!-- #vrt positional-attributes: word -->
      <text b="T" c="d" a="b" e="x" f="T" g="w" d="T">
      <sentence a="" b="" c="" d="" e="">
      a
      </sentence>
      </text>
      <text b="z" c="T" a="y" e="T" f="v" g="T" d="a">
      <sentence a="" b="1" c="2" d="" e="4">
      b
      </sentence>
      <sentence a="0" b="" c="" d="3" e="">
      c
      </sentence>
      </text>
  transform: *transform-stdin-comma

- name: 'vrt-unify-attrs: Structure-specific and default options'
  input:
    cmdline: vrt-unify-attrs --default="_" --last=d --structure=text --first="b,c" --default="T" --structure=sentence --first=e in.vrt
    file:in.vrt: *input-4
  output:
    stdout: |
      <!-- #vrt positional-attributes: word -->
      <text b="T" c="d" a="b" e="x" f="T" g="w" d="T">
      <sentence e="_" a="_" b="_" c="_" d="_">
      a
      </sentence>
      </text>
      <text b="z" c="T" a="y" e="T" f="v" g="T" d="a">
      <sentence e="4" a="_" b="1" c="2" d="_">
      b
      </sentence>
      <sentence e="_" a="0" b="_" c="_" d="3">
      c
      </sentence>
      </text>
  transform: *transform-stdin-comma


- name: 'vrt-unify-attrs: --always with attributes occurring in input'
  input:
    cmdline: vrt-unify-attrs --always="a,b" --default="_" in.vrt
    file:in.vrt: *input-4
  output:
    stdout: |
      <!-- #vrt positional-attributes: word -->
      <text a="b" b="_" c="d" d="_" e="x" f="_" g="w">
      <sentence a="_" b="_" c="_" d="_" e="_">
      a
      </sentence>
      </text>
      <text a="y" b="z" c="_" d="a" e="_" f="v" g="_">
      <sentence a="_" b="1" c="2" d="_" e="4">
      b
      </sentence>
      <sentence a="0" b="_" c="_" d="3" e="_">
      c
      </sentence>
      </text>
  transform: *transform-stdin-comma

- name: 'vrt-unify-attrs: --always with some attributes not occurring in input'
  input:
    cmdline: vrt-unify-attrs --always="z,f,_a,a" --default="_" in.vrt
    file:in.vrt: *input-4
  output:
    stdout: |
      <!-- #vrt positional-attributes: word -->
      <text _a="_" a="b" b="_" c="d" d="_" e="x" f="_" g="w" z="_">
      <sentence _a="_" a="_" b="_" c="_" d="_" e="_" f="_" z="_">
      a
      </sentence>
      </text>
      <text _a="_" a="y" b="z" c="_" d="a" e="_" f="v" g="_" z="_">
      <sentence _a="_" a="_" b="1" c="2" d="_" e="4" f="_" z="_">
      b
      </sentence>
      <sentence _a="_" a="0" b="_" c="_" d="3" e="_" f="_" z="_">
      c
      </sentence>
      </text>
  transform: *transform-stdin-comma

- name: 'vrt-unify-attrs: --always, --input-order, some attributes not occurring in input'
  input:
    cmdline: vrt-unify-attrs --always="z,f,_a,a" --input-order --default="_" in.vrt
    file:in.vrt: *input-4
  output:
    stdout: |
      <!-- #vrt positional-attributes: word -->
      <text g="w" a="b" c="d" e="x" b="_" f="_" d="_" z="_" _a="_">
      <sentence c="_" e="_" b="_" d="_" a="_" z="_" f="_" _a="_">
      a
      </sentence>
      </text>
      <text g="_" a="y" c="_" e="_" b="z" f="v" d="a" z="_" _a="_">
      <sentence c="2" e="4" b="1" d="_" a="_" z="_" f="_" _a="_">
      b
      </sentence>
      <sentence c="_" e="_" b="_" d="3" a="0" z="_" f="_" _a="_">
      c
      </sentence>
      </text>
  transform: *transform-stdin-comma

- name: 'vrt-unify-attrs: --always, --first, some attributes not occurring in input'
  input:
    cmdline: vrt-unify-attrs --always="z,f,_a,a" --first="f,z" --default="_" in.vrt
    file:in.vrt: *input-4
  output:
    stdout: |
      <!-- #vrt positional-attributes: word -->
      <text f="_" z="_" _a="_" a="b" b="_" c="d" d="_" e="x" g="w">
      <sentence f="_" z="_" _a="_" a="_" b="_" c="_" d="_" e="_">
      a
      </sentence>
      </text>
      <text f="v" z="_" _a="_" a="y" b="z" c="_" d="a" e="_" g="_">
      <sentence f="_" z="_" _a="_" a="_" b="1" c="2" d="_" e="4">
      b
      </sentence>
      <sentence f="_" z="_" _a="_" a="0" b="_" c="_" d="3" e="_">
      c
      </sentence>
      </text>
  transform: *transform-stdin-comma

- name: 'vrt-unify-attrs: Structure-specific --always, some attributes not occurring in input'
  input:
    cmdline: vrt-unify-attrs --default="_" --always="z,f,_a,a" --first="f,z" --structure=text --always="y,x" in.vrt
    file:in.vrt: *input-4
  output:
    stdout: |
      <!-- #vrt positional-attributes: word -->
      <text f="_" a="b" b="_" c="d" d="_" e="x" g="w" x="_" y="_">
      <sentence f="_" z="_" _a="_" a="_" b="_" c="_" d="_" e="_">
      a
      </sentence>
      </text>
      <text f="v" a="y" b="z" c="_" d="a" e="_" g="_" x="_" y="_">
      <sentence f="_" z="_" _a="_" a="_" b="1" c="2" d="_" e="4">
      b
      </sentence>
      <sentence f="_" z="_" _a="_" a="0" b="_" c="_" d="3" e="_">
      c
      </sentence>
      </text>
  transform: *transform-stdin-comma

- name: 'vrt-unify-attrs: --always with duplicate attribute names'
  input:
    cmdline: vrt-unify-attrs --always="z,f,z,a" in.vrt
    file:in.vrt: *input-4
  output:
    stdout: ''
    returncode: 2
    stderr:
      contains: |
        vrt-unify-attrs: error: argument --always: duplicate attribute names: z
  transform: *transform-stdin-comma
